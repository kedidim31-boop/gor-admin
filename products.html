<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Produktverwaltung ‚Äì Gaming of Republic</title>
  <link rel="stylesheet" href="assets/css/layout.css" />
</head>
<body>
  <nav class="navbar">
    <div class="logo">üïπÔ∏è Gaming of Republic | Produktverwaltung</div>
    <ul>
      <li><button id="addRowBtn" class="btn">+ NEUES PRODUKT</button></li>
      <li><button id="bulkImportBtn" class="btn">Bulk Import</button></li>
      <li><button id="exportBtn" class="btn">CSV Export</button></li>
      <li><button id="logoutBtn" class="btn delete">üö™ Abmelden</button></li>
    </ul>
  </nav>

  <main class="content">
    <h1>Produktverwaltung</h1>

    <table id="productTable">
      <thead>
        <tr>
          <th>STATUS</th>
          <th>TITEL</th>
          <th>BESCHREIBUNG</th>
          <th>ANBIETER</th>
          <th>TYP</th>
          <th>KOLLEKTIONEN</th>
          <th>TAGS</th>
          <th>PREIS</th>
          <th>SKU + GENERATOR</th>
          <th>EAN</th>
          <th>BESTAND</th>
          <th>BILDER</th>
          <th>AKTIONEN</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

<script>
  const tbody = document.querySelector("#productTable tbody");
  let productList = [];

  // Funktion zum Hinzuf√ºgen einer einzelnen Zeile
  function addRow(p) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td contenteditable="true">${p.status}</td>
      <td contenteditable="true">${p.title}</td>
      <td contenteditable="true">${p.description}</td>
      <td contenteditable="true">${p.provider}</td>
      <td contenteditable="true">${p.type}</td>
      <td contenteditable="true">${p.collections}</td>
      <td contenteditable="true">${p.tags}</td>
      <td contenteditable="true">${p.price}</td>
      <td contenteditable="true">${p.sku} <button class="btn generate">SKU GENERIEREN</button></td>
      <td contenteditable="true">${p.ean}</td>
      <td contenteditable="true">${p.stock}</td>
      <td>
        <div class="dropzone">
          ${p.image ? `<img src="${p.image}">` : "üìÅ Bilder hier ablegen oder klicken"}
        </div>
      </td>
      <td><button class="btn delete">üóëÔ∏è L√∂schen</button></td>
    `;
    tbody.appendChild(tr);

    // Drag & Drop f√ºr Bilder
    const zone = tr.querySelector(".dropzone");
    zone.addEventListener("dragover", e => e.preventDefault());
    zone.addEventListener("drop", e => {
      e.preventDefault();
      const file = e.dataTransfer.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        p.image = ev.target.result;
        zone.innerHTML = `<img src="${p.image}">`;
      };
      reader.readAsDataURL(file);
    });

    // SKU Generator
    tr.querySelector(".generate").addEventListener("click", () => {
      p.sku = "SKU-" + Math.random().toString(36).substring(2, 8).toUpperCase();
      tr.cells[8].innerHTML = `${p.sku} <button class="btn generate">SKU GENERIEREN</button>`;
    });

    // L√∂schen
    tr.querySelector(".delete").addEventListener("click", () => {
      tr.remove();
      productList = productList.filter(item => item !== p);
    });
  }

  // Neue Zeile hinzuf√ºgen
  document.getElementById("addRowBtn").addEventListener("click", () => {
    const newProduct = {
      status: "Entwurf",
      title: "",
      description: "",
      provider: "",
      type: "",
      collections: "",
      tags: "",
      price: "",
      sku: "",
      ean: "",
      stock: "",
      image: ""
    };
    productList.push(newProduct);
    addRow(newProduct);
  });

  // CSV Export
  document.getElementById("exportBtn").addEventListener("click", () => {
    let csv = ["STATUS,TITEL,BESCHREIBUNG,ANBIETER,TYP,KOLLEKTIONEN,TAGS,PREIS,SKU,EAN,BESTAND,BILD"];
    const rows = tbody.querySelectorAll("tr");
    rows.forEach(row => {
      const cells = row.querySelectorAll("td");
      const imageCell = row.querySelector("img");
      csv.push([
        cells[0].innerText,
        cells[1].innerText,
        cells[2].innerText,
        cells[3].innerText,
        cells[4].innerText,
        cells[5].innerText,
        cells[6].innerText,
        cells[7].innerText,
        cells[8].innerText.split(" ")[0], // nur SKU Text
        cells[9].innerText,
        cells[10].innerText,
        imageCell ? "Bild vorhanden" : ""
      ].join(","));
    });

    const csvContent = "data:text/csv;charset=utf-8," + csv.join("\n");
    const link = document.createElement("a");
    link.setAttribute("href", csvContent);
    link.setAttribute("download", "produkte.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  });

  // Bulk Import Platzhalter
  document.getElementById("bulkImportBtn").addEventListener("click", () => {
    alert("Bulk Import ist noch nicht aktiviert.");
  });

  // Logout
  document.getElementById("logoutBtn").addEventListener("click", () => {
    alert("Du wurdest abgemeldet.");
    window.location.href = "login.html";
  });
</script>
</body>
</html>
