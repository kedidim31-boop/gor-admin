<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Produkte â€“ Gaming of Republic</title>
  <link rel="stylesheet" href="assets/css/layout.css">
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">ğŸ•¹ï¸ Gaming of Republic</div>
    <button id="logoutBtn" class="btn delete top-right">Abmelden</button>
    <div class="sidebar-scroll">
      <ul>
        <li><a href="index.html">ğŸ  Ãœbersicht</a></li>
        <li><a href="products.html" class="active">ğŸ“¦ Produkte</a></li>
        <li><a href="users.html">ğŸ‘¥ Benutzer</a></li>
        <li><a href="tasks.html">âœ… Aufgaben</a></li>
        <li><a href="logs.html">ğŸ“‘ AktivitÃ¤ts-Logs</a></li>
        <li><a href="settings.html">âš™ï¸ Einstellungen</a></li>
      </ul>
      <div class="sidebar-actions">
        <button id="addRowBtn" class="btn">â• Produkt hinzufÃ¼gen</button>
        <button id="bulkImportBtn" class="btn">ğŸ“¥ Produkte importieren</button>
        <button id="exportBtn" class="btn">ğŸ“¤ Produkte exportieren</button>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="content">
    <h1>Produktverwaltung</h1>
    <div class="card">
      <h2>Produkte</h2>
      <table id="productTable">
        <thead>
          <tr>
            <th>Status</th>
            <th>Titel</th>
            <th>Beschreibung</th>
            <th>Anbieter</th>
            <th>Typ</th>
            <th>Kategorien</th>
            <th>Tags</th>
            <th>Preis</th>
            <th>SKU</th>
            <th>EAN</th>
            <th>Bestand</th>
            <th>Bilder</th>
            <th>Aktionen</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p id="footerText"></p>
  </footer>

  <!-- Auth und Logik -->
  <script src="assets/js/auth.js"></script>
  <script>
    document.getElementById("logoutBtn").addEventListener("click", handleLogout);
    const tbody = document.querySelector("#productTable tbody");
    let productList = [];

    function addRow(p) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td contenteditable="true">${p.status}</td>
        <td contenteditable="true">${p.title}</td>
        <td><textarea class="description-area">${p.description}</textarea></td>
        <td contenteditable="true">${p.provider}</td>
        <td contenteditable="true">${p.type}</td>
        <td contenteditable="true">${p.collections}</td>
        <td contenteditable="true">${p.tags}</td>
        <td contenteditable="true">${p.price}</td>
        <td>${p.sku} <button class="btn generate">ğŸ”„ SKU</button></td>
        <td contenteditable="true">${p.ean}</td>
        <td contenteditable="true">${p.stock}</td>
        <td><div class="dropzone">${p.image ? `<img src="${p.image}">` : "ğŸ“ Bild hier ablegen"}</div></td>
        <td>
          <button class="btn saveProduct">ğŸ’¾ Speichern</button>
          <button class="btn editProduct">âœï¸ Bearbeiten</button>
          <button class="btn delete">ğŸ—‘ï¸ LÃ¶schen</button>
        </td>
      `;
      tbody.appendChild(tr);

      // Drag & Drop fÃ¼r Bilder
      const zone = tr.querySelector(".dropzone");
      zone.addEventListener("dragover", e => e.preventDefault());
      zone.addEventListener("drop", e => {
        e.preventDefault();
        const file = e.dataTransfer.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = ev => {
          p.image = ev.target.result;
          zone.innerHTML = `<img src="${p.image}">`;
        };
        reader.readAsDataURL(file);
      });

      // SKU Generator
      tr.querySelector(".generate").addEventListener("click", () => {
        p.sku = "SKU-" + Math.random().toString(36).substring(2, 8).toUpperCase();
        tr.cells[8].innerHTML = `${p.sku} <button class="btn generate">ğŸ”„ SKU</button>`;
      });

      // Speichern
      tr.querySelector(".saveProduct").addEventListener("click", () => {
        p.status = tr.cells[0].innerText;
        p.title = tr.cells[1].innerText;
        p.description = tr.querySelector(".description-area").value;
        p.provider = tr.cells[3].innerText;
        p.type = tr.cells[4].innerText;
        p.collections = tr.cells[5].innerText;
        p.tags = tr.cells[6].innerText;
        p.price = tr.cells[7].innerText;
        p.sku = tr.cells[8].innerText.split(" ")[0];
        p.ean = tr.cells[9].innerText;
        p.stock = tr.cells[10].innerText;
        alert("Produkt gespeichert!");
      });

      // Bearbeiten
      tr.querySelector(".editProduct").addEventListener("click", () => {
        alert("Bearbeiten-Modus: Felder sind direkt editierbar.");
      });

      // LÃ¶schen
      tr.querySelector(".delete").addEventListener("click", () => {
        tr.remove();
        productList = productList.filter(item => item !== p);
      });
    }

    document.getElementById("addRowBtn").addEventListener("click", () => {
      const newProduct = {
        status: "Entwurf",
        title: "",
        description: "",
        provider: "",
        type: "",
        collections: "",
        tags: "",
        price: "",
        sku: "",
        ean: "",
        stock: "",
        image: ""
      };
      productList.push(newProduct);
      addRow(newProduct);
    });

    document.getElementById("exportBtn").addEventListener("click", () => {
      let csv = ["Status,Titel,Beschreibung,Anbieter,Typ,Kategorien,Tags,Preis,SKU,EAN,Bestand,Bild"];
      const rows = tbody.querySelectorAll("tr");
      rows.forEach(row => {
        const cells = row.querySelectorAll("td");
        const imageCell = row.querySelector("img");
        const description = row.querySelector(".description-area").value;
        csv.push([
          cells[0].innerText,
          cells[1].innerText,
          description,
          cells[3].innerText,
          cells[4].innerText,
          cells[5].innerText,
          cells[6].innerText,
          cells[7].innerText,
          cells[8].innerText.split(" ")[0],
          cells[9].innerText,
          cells[10].innerText,
          imageCell ? "Bild vorhanden" : ""
        ].join(","));
      });

      const csvContent = "data:text/csv;charset=utf-8," + csv.join("\\n");
      const link = document.createElement("a");
      link.setAttribute("href", csvContent);
      link.setAttribute("download", "produkte.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    document.getElementById("bulkImportBtn").addEventListener("click", () => {
      alert("Bulk Import ist noch nicht implementiert.");
    });
  </script>
</body>
