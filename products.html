<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Produktverwaltung ‚Äì Gaming of Republic</title>
  <link rel="stylesheet" href="assets/css/layout.css" />
</head>
<body>
  <nav class="navbar">
    <div class="logo">üïπÔ∏è Gaming of Republic | Produktverwaltung</div>
    <ul>
      <li><button id="addRowBtn" class="btn">+ NEUES PRODUKT</button></li>
      <li><button id="bulkImportBtn" class="btn">Bulk Import</button></li>
      <li><button id="exportBtn" class="btn">CSV Export</button></li>
      <li><button id="logoutBtn" class="btn delete">üö™ Abmelden</button></li>
    </ul>
  </nav>

  <main class="content">
    <h1>Produktverwaltung</h1>

    <table id="productTable">
      <thead>
        <tr>
          <th>STATUS</th>
          <th>TITEL</th>
          <th>BESCHREIBUNG</th>
          <th>ANBIETER</th>
          <th>TYP</th>
          <th>KOLLEKTIONEN</th>
          <th>TAGS</th>
          <th>PREIS</th>
          <th>SKU + GENERATOR</th>
          <th>EAN</th>
          <th>BESTAND</th>
          <th>BILDER</th>
          <th>AKTIONEN</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

<script>
  const tbody = document.querySelector("#productTable tbody");
  let productList = [];

  function renderTable() {
    tbody.innerHTML = "";
    productList.forEach((p, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td contenteditable="true">${p.status}</td>
        <td contenteditable="true">${p.title}</td>
        <td contenteditable="true">${p.description}</td>
        <td contenteditable="true">${p.provider}</td>
        <td contenteditable="true">${p.type}</td>
        <td contenteditable="true">${p.collections}</td>
        <td contenteditable="true">${p.tags}</td>
        <td contenteditable="true">${p.price}</td>
        <td contenteditable="true">${p.sku} <button class="btn generate" data-index="${i}">SKU GENERIEREN</button></td>
        <td contenteditable="true">${p.ean}</td>
        <td contenteditable="true">${p.stock}</td>
        <td>
          <div class="dropzone" data-index="${i}">
            ${p.image ? `<img src="${p.image}">` : "üìÅ Bilder hier ablegen oder klicken"}
          </div>
        </td>
        <td><button class="btn delete" data-index="${i}">üóëÔ∏è L√∂schen</button></td>
      `;
      tbody.appendChild(tr);

      const zone = tr.querySelector(".dropzone");
      zone.addEventListener("dragover", e => e.preventDefault());
      zone.addEventListener("drop", e => {
        e.preventDefault();
        const file = e.dataTransfer.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(ev) {
          productList[i].image = ev.target.result;
          renderTable();
        };
        reader.readAsDataURL(file);
      });

      tr.querySelector(".delete").addEventListener("click", () => {
        productList.splice(i, 1);
        renderTable();
      });

      tr.querySelector(".generate").addEventListener("click", () => {
        productList[i].sku = "SKU-" + Math.random().toString(36).substring(2, 8).toUpperCase();
        renderTable();
      });
    });
  }

  document.getElementById("addRowBtn").addEventListener("click", () => {
    productList.push({
      status: "Entwurf",
      title: "",
      description: "",
      provider: "",
      type: "",
      collections: "",
      tags: "",
      price: "",
      sku: "",
      ean: "",
      stock: "",
      image: ""
    });
    renderTable();
  });

  document.getElementById("exportBtn").addEventListener("click", () => {
    let csv = ["STATUS,TITEL,BESCHREIBUNG,ANBIETER,TYP,KOLLEKTIONEN,TAGS,PREIS,SKU,EAN,BESTAND,BILD"];
    productList.forEach(p => {
      csv.push([
        p.status, p.title, p.description, p.provider, p.type, p.collections,
        p.tags, p.price, p.sku, p.ean, p.stock, p.image ? "Bild vorhanden" : ""
      ].join(","));
    });
    const csvContent = "data:text/csv;charset=utf-8," + csv.join("\n");
    const link = document.createElement("a");
    link.setAttribute("href", csvContent);
    link.setAttribute("download", "produkte.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  });

  document.getElementById("bulkImportBtn").addEventListener("click", () => {
    alert("Bulk Import ist noch nicht aktiviert.");
  });

  document.getElementById("logoutBtn").addEventListener("click", () => {
    alert("Du wurdest abgemeldet.");
    window.location.href = "login.html";
  });
</script>
</body>
</html>
