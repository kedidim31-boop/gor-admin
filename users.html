<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gaming of Republic â€“ Benutzerverwaltung</title>
  <link rel="stylesheet" href="assets/css/layout.css">
</head>
<body>
  <nav class="navbar">
    <div class="logo">ğŸ•¹ï¸ Gaming of Republic</div>
    <ul>
      <li><a href="index.html">Dashboard</a></li>
      <li><a href="add-product.html">Neues Produkt</a></li>
      <li><a href="products.html">Produkte</a></li>
      <li><a href="users.html" class="active">Benutzerverwaltung</a></li>
      <li><button id="logoutBtn" class="btn delete">ğŸšª Abmelden</button></li>
    </ul>
  </nav>

  <main class="content">
    <h1>Benutzerverwaltung</h1>

    <!-- Formular fÃ¼r neuen Benutzer -->
    <form id="userForm">
      <label>Benutzername</label>
      <input type="text" name="username" required>

      <label>E-Mail</label>
      <input type="email" name="email" required>

      <label>Passwort</label>
      <input type="password" name="password" required>

      <label>Rolle</label>
      <select name="role" required>
        <option value="admin">Administrator</option>
        <option value="editor">Editor</option>
        <option value="viewer">Viewer</option>
      </select>

      <label>Status</label>
      <select name="status" required>
        <option value="Aktiv">Aktiv</option>
        <option value="Entwurf">Entwurf</option>
      </select>

      <button type="submit" class="btn">â• Benutzer hinzufÃ¼gen</button>
    </form>

    <!-- Tabelle mit Benutzern -->
    <table class="product-table" id="userTable">
      <thead>
        <tr>
          <th>Benutzername</th>
          <th>E-Mail</th>
          <th>Rolle</th>
          <th>Status</th>
          <th>Aktionen</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <script>
    // Zugriffsschutz: nur Admin darf Benutzerverwaltung Ã¶ffnen
    const loggedUser = localStorage.getItem("loggedInUser");
    const loggedRole = localStorage.getItem("userRole");

    if(!loggedUser) {
      window.location.href = "login.html";
    } else if(loggedRole !== "admin") {
      alert("Nur Administratoren dÃ¼rfen die Benutzerverwaltung Ã¶ffnen!");
      window.location.href = "index.html";
    }

    // Logout-Funktion
    const logoutBtn = document.getElementById("logoutBtn");
    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem("loggedInUser");
      localStorage.removeItem("userRole");
      alert("Du wurdest abgemeldet.");
      window.location.href = "login.html";
    });

    // Benutzerliste aus localStorage laden oder Standard-Admin setzen
    let users = JSON.parse(localStorage.getItem("userList")) || [];
    if(users.length === 0) {
      users.push({
        username: "admin",
        email: "admin@gor.com",
        password: "1234",
        role: "admin",
        status: "Aktiv"
      });
      localStorage.setItem("userList", JSON.stringify(users));
    }

    const tbody = document.querySelector("#userTable tbody");

    function renderUsers() {
      tbody.innerHTML = "";
      users.forEach(u => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${u.username}</td>
          <td>${u.email}</td>
          <td>${u.role}</td>
          <td>${u.status}</td>
          <td>
            <button class="btn edit">âœï¸ Edit</button>
            <button class="btn delete">ğŸ—‘ï¸ Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
        bindActions(tr, u);
      });
    }

    // Benutzer hinzufÃ¼gen
    document.getElementById('userForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const newUser = {
        username: this.username.value,
        email: this.email.value,
        password: this.password.value,
        role: this.role.value,
        status: this.status.value
      };
      users.push(newUser);
      localStorage.setItem("userList", JSON.stringify(users));
      renderUsers();
      this.reset();
    });

    // Aktionen binden
    function bindActions(row, userObj) {
      row.querySelector('.edit').addEventListener('click', () => {
        const newPass = prompt("Neues Passwort fÃ¼r " + userObj.username, userObj.password);
        if(newPass !== null) {
          userObj.password = newPass;
          localStorage.setItem("userList", JSON.stringify(users));
          renderUsers();
        }
      });

      row.querySelector('.delete').addEventListener('click', () => {
        if(confirm("Willst du diesen Benutzer wirklich lÃ¶schen?")) {
          users = users.filter(u => u !== userObj);
          localStorage.setItem("userList", JSON.stringify(users));
          renderUsers();
        }
      });
    }

    // Initial render
    renderUsers();
  </script>
</body>
</html>
